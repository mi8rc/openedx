name: Build Offline Course (Docker)

on:
  workflow_dispatch:

jobs:
  build-course:
    runs-on: ubuntu-22.04

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Pull Docker image
        run: docker pull ghcr.io/openzim/openedx:dev

      - name: Run openedx2zim
        run: |
          mkdir -p offline_course
          docker run --rm \
            -v ${{ github.workspace }}/offline_course:/offline_course \
            ghcr.io/openzim/openedx:dev \
            openedx2zim \
              --course-url "https://iedra.uned.es/courses/course-v1:UNED+TYEPRO+2021/course/" \
              --email "${{ secrets.UNED_EMAIL }}" \
              --password "${{ secrets.UNED_PASSWORD }}" \
              --name "tyepro2021" \
              --title "Tecnicas y Estrategias Profesionales (2021)" \
              --description "Offline export of the UNED iedra course Tecnicas y Estrategias Profesionales 2021" \
              --creator "UNED" \
              --publisher "iedra.uned.es" \
              --tags "UNED,iedra,tyepro2021,course" \
              --output "/offline_course" \
              --skip-extras

      - name: Upload ZIM
        uses: actions/upload-artifact@v4
        with:
          name: tyepro2021-zim
          path: offline_course/*.zim
